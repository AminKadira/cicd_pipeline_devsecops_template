{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "_templateVersion": "2.0.0",
    "_documentation": "Template for creating new project configurations. Fields marked with _required: true are mandatory.",
    
    "project": {
      "_required": true,
      "name": "{{PROJECT_NAME}}",
      "description": "DevSecOps Pipeline Configuration for {{PROJECT_NAME}}",
      "team": "{{TEAM_NAME}}",
      "triggerRepoPattern": "^{{PROJECT_NAME}}(\\.git)?$",
      "gitUrl": "git@gitlab.fr.pluxee.tools:cicd/{{PROJECT_NAME}}.git",
      "gitBranch": "release/cicd",
      "gitCredentials": "git-ssh-key",
      "jenkinsAgent": "plxfrsr-l1pi027",
      "stack": {
        "_required": true,
        "_enum": ["dotnet", "dotnet-core", "java", "angular", "php", "node", "sql", "multi"],
        "value": "dotnet-core"
      },
      "environments": [
        {
          "name": "tst",
          "displayName": "Test",
          "jenkinsAgent": null,
          "targetServers": [],
          "deployEnabled": false
        },
        {
          "name": "sta",
          "displayName": "Staging",
          "jenkinsAgent": null,
          "targetServers": [],
          "deployEnabled": false,
          "requiresApproval": false
        },
        {
          "name": "prd",
          "displayName": "Production",
          "jenkinsAgent": null,
          "targetServers": [],
          "deployEnabled": false,
          "requiresApproval": true,
          "approvers": ["lead-dev", "product-owner"]
        }
      ]
    },
  
    "components": {
      "_documentation": "Define what to build. At least one component type required.",
      "apis": {
        "enabled": false,
        "items": [
          {
            "name": "{{PROJECT_NAME}}.Api",
            "type": "Api",
            "framework": ".NET Core 3.1",
            "publishPath": "publish/{{ENVIRONMENT}}"
          }
        ]
      },
      "workers": {
        "enabled": false,
        "items": [
          {
            "name": "{{PROJECT_NAME}}.Worker",
            "type": "Worker",
            "framework": ".NET Core 3.1"
          }
        ]
      },
      "batches": {
        "enabled": false,
        "items": [
          {
            "name": "{{PROJECT_NAME}}.Batch",
            "type": "Batch",
            "runtime": "java",
            "mainClass": "com.pluxee.Main"
          }
        ]
      },
      "angular": {
        "enabled": false,
        "items": [
          {
            "name": "{{PROJECT_NAME}}-frontend",
            "nodeVersion": "20",
            "buildCommand": "npm run build:prod",
            "testCommand": "npm run test:ci",
            "outputDir": "dist"
          }
        ]
      },
      "dbScripts": {
        "enabled": false,
        "items": [
          {
            "name": "{{PROJECT_NAME}}-migrations",
            "type": "sql",
            "tool": "flyway",
            "scriptsPath": "db/migrations"
          }
        ]
      }
    },
  
    "build": {
      "_required": true,
      "scriptPath": "D:\\_puppet\\script\\buildDotNetCore3.1.ps1",
      "framework": ".NET Core 3.1",
      "configuration": "Release",
      "verbosity": "normal",
      "proxyServer": "proxy.fr.pluxee.tools",
      "proxyPort": "3128",
      "restorePackages": true,
      "runTests": false,
      "artifacts": {
        "pattern": "**/bin/Release/**/*.dll",
        "exclude": ["**/obj/**", "**/test/**", "**/*.pdb"]
      },
      "cache": {
        "enabled": true,
        "paths": ["~/.nuget/packages", "node_modules"]
      }
    },
  
    "security": {
      "_required": true,
      "gitleaks": {
        "enabled": true,
        "configFile": "config/gitleaks.toml",
        "scanHistory": false,
        "baselineFile": null
      },
      "dependencyScan": {
        "enabled": true,
        "tool": "dotnet-native",
        "failOnCritical": true,
        "failOnHigh": true,
        "failOnMedium": false
      },
      "owaspDependencyCheck": {
        "enabled": true,
        "failOnCVSS": 7.0,
        "formats": ["HTML", "JSON", "XML"],
        "suppressionFile": "config/suppression-owasp.xml",
        "offlineMode": true,
        "nvdFeedsDir": "src/Assets/owasp_dependency/nvd-feeds"
      },
      "codeAnalysis": {
        "enabled": true,
        "tool": "SonarQube",
        "projectKeyPrefix": "BRS.FR.",
        "exclusions": {
          "sources": ["**/*.html", "**/tests/**/*.*", "**/*.json"],
          "coverage": ["**/tests/**/*.*", "**/DTOs/**/*.cs"],
          "duplications": ["**/DTOs/**/*.cs", "**/*.json"]
        }
      },
      "dast": {
        "enabled": false,
        "tool": "OWASP ZAP",
        "targetUrl": null,
        "scanType": "baseline"
      }
    },
  
    "testing": {
      "unit": {
        "enabled": false,
        "framework": "xunit",
        "coverageThreshold": 80,
        "reportFormats": ["trx", "cobertura"]
      },
      "integration": {
        "enabled": false,
        "framework": "playwright",
        "browsers": ["chromium"],
        "workers": 1,
        "retries": 1
      },
      "healthCheck": {
        "enabled": true,
        "endpoint": "/health",
        "timeout": 120,
        "retries": 5
      }
    },
  
    "deploy": {
      "scriptPath": "D:\\_puppet\\script\\deployDotNetCore3.1.ps1",
      "strategy": {
        "_enum": ["all-at-once", "rolling", "blue-green"],
        "tst": "all-at-once",
        "sta": "rolling",
        "prd": "blue-green"
      },
      "rollback": {
        "enabled": true,
        "keepVersions": 3
      },
      "healthCheckAfterDeploy": true,
      "warmupEnabled": false
    },
  
    "notifications": {
      "devteam": [],
      "qateam": [
        "amin.kadira.ext@pluxeegroup.com",
        "jeanmichel.robert@pluxeegroup.com"
      ],
      "securityTeam": [],
      "onSuccess": false,
      "onFailure": true,
      "onUnstable": true
    },
  
    "logging": {
      "level": "INFO",
      "retention": {
        "builds": 30,
        "daysToKeep": 90
      },
      "archiveArtifacts": true
    },
  
    "quality": {
      "failBuild": {
        "onSecurityIssues": true,
        "onTestFailure": true,
        "onBuildFailure": true,
        "onDeploymentFailure": true,
        "onQualityGateFail": false
      }
    },
  
    "_examples": {
      "minimalDotNet": {
        "project.name": "my-api",
        "project.stack.value": "dotnet-core",
        "components.apis.enabled": true,
        "components.apis.items[0].name": "My.Api"
      },
      "minimalAngular": {
        "project.name": "my-frontend",
        "project.stack.value": "angular",
        "components.angular.enabled": true
      },
      "fullStack": {
        "project.stack.value": "multi",
        "components.apis.enabled": true,
        "components.angular.enabled": true,
        "components.dbScripts.enabled": true
      }
    }
}